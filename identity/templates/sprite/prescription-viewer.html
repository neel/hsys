{% load staticfiles %}
{% load identity_extras %}
<html moznomarginboxes mozdisallowselectionprint>
    <head>
        <title>Prescription for {{story.patient.get_full_name}}</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.min.css">
        <style type='text/css'>
            @import url("{% static 'css/common.css' %}");
            @import url("{% static 'css/heading.css' %}");
            @import url("{% static 'css/sprite/prescription-viewer.css' %}");
            @import url("{% static 'css/panel/prescription-creator.css' %}");
            @import url("{% static 'css/doctor.css' %}");
            @import url("{% static 'css/sprite/story-viewer.css' %}");
        </style>
        <script type="text/javascript" src="{% static 'js/jquery.1.9.0.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/jquery.sticky-kit.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/d3.v3.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/moment.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/jquery.qrcode.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/panel/prescription-creator.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/sprite/story-viewer.js' %}"></script>
        <script type="text/javascript">
            $(document).ready(function(){
                //$('#qr').qrcode({text: '{"p":{{story.patient.id}},"d":{{story.doctor.id}},"s":{{story.id}}}', width: 128, height: 128, ecLevel: 'L'});
                $('#qr').qrcode({text: "{{story.label}}", width: 128, height: 128, ecLevel: 'L'});
                {% for prescription in prescriptions %}
                    var data = {{prescription.body|jsonify|safe}};
                    render_prescription_data(data, $('#envelops'));
                {% endfor %}
                $('#envelops').find('.medication-medicine').each(function(){
                    var btn = $(this).find('.translate-bn');
                    btn.trigger('click');
                });
            })
        </script>
    </head>
    <body>
        <div class="main" id="main">
            <div class="content">
                <div class="prescription">
                    <div class="prescription-head">
                        <img class="prescription-logo" src="/static/pix/doctor-logo.jpg" />
                        <div id="qr" class="prescription-qr"></div>
                        <div class="prescription-meta">
                            <div class="prescription-doctor">
                                <div class="prescription-doctor-name">{{story.doctor.get_full_name}}</div>
                                <div class="prescription-doctor-specialization">{{story.doctor.specialization}}</div>
                                <div class="prescription-when">{{story.when}}</div>
                            </div>
                            <div class="prescription-patient">
                                <div class="prescription-patient-name">{{story.patient.get_full_name}}</div>
                                <div class="prescription-patient-age">{{story.patient.sex}} {{story.patient.age|delta_string}}</div>
                                <div class="prescription-patient-email">{{story.patient.email}}</div>
                            </div>
                        </div>
                    </div>
                    <div class="prescription-content">
                        {% for complaint in complaints %}
                        <div class="complaint-section complaint-section-vitals">
                            <div class="complaint-section-heading complaint-section-heading-vitals"></div>
                            <div class="complaint-section-body">
                                {{ complaint.body.sensorData|complaint_vitals|safe }}
                            </div>
                        </div>
                        {% endfor %}
                        <div class="prescription-complaints">
                            <div class="prescription-complaints-label">
                                complaint{% if prescriptions|length > 1 %}s{% endif %}
                            </div>
                            {% for complaint in complaints %}
                                <div class="prescription-complaint">
                                    <div class="complaint-section complaint-section-symptom">
                                        <div class="complaint-section-heading complaint-section-heading-symptom"></div>
                                        <div class="complaint-section-body">
                                            {{ complaint.body.symptoms|complaint_symptoms_summarized|safe }}
                                        </div>
                                    </div>
                                    <div class="prescription-print-columns prescription-print-columns-3">
                                        <div class="prescription-print-column complaint-section complaint-section-observation">
                                            <div class="complaint-section-heading complaint-section-heading-observation"></div>
                                            <div class="complaint-section-body">
                                                {{ complaint.body.generalObservation|complaint_observations|safe }}
                                            </div>
                                        </div>
                                        <div class="prescription-print-column complaint-section complaint-section-habit">
                                            <div class="complaint-section-heading complaint-section-heading-habit"></div>
                                            <div class="complaint-section-body">
                                                {{ complaint.body.habit|complaint_habits|safe }}
                                            </div>
                                        </div>
                                        <div class="prescription-print-column complaint-section complaint-section-history">
                                            <div class="complaint-section-heading complaint-section-heading-history"></div>
                                            <div class="complaint-section-body">
                                                {{ complaint.body.medicalHistory|complaint_history|safe }}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="prescription-print-column complaint-section complaint-section-postexams">
                                        <div class="complaint-section-heading complaint-section-heading-postexams"></div>
                                        <div class="complaint-section-body">
                                            {{ complaint.body.post_exam|complaint_postexams_summarized|safe }}
                                        </div>
                                    </div>
                                    <div class="prescription-print-column complaint-section complaint-section-family">
                                        <div class="complaint-section-heading complaint-section-heading-family"></div>
                                        <div class="complaint-section-body">
                                            {{ complaint.body.familyHistory|complaint_family_summarized|safe }}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <div class="prescription-prescriptions">
                            <div class="prescription-prescriptions-label">
                                prescription{% if prescriptions|length > 1 %}s{% endif %}
                            </div>
                            {% for prescription in prescriptions %}
                                <div class="prescription-prescription">
                                    <div class="prescription-prescription-medicines">
                                        <div id="envelops" class="prescription-prescription-medicines-list">
                                            {% for medicine in prescription.body.envelops %}
                                                <li class="prescription-prescription-medicines-list-item">
                                                    
                                                </li>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer">
                {% for complaint in complaints %}
                    {% if complaint.randomvisit %}
                    <div class="caregiver-assistance">
                        <div class="caregiver-name">
                        {{ complaint.randomvisit.operator.get_full_name }}
                        </div>
                        <div class="caregiver-organization">
                            at
                        {{ complaint.randomvisit.org }}
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
                <div class="doctor-signature">
                    {% for complaint in complaints %}
                    <img class="doctor-signature-imagee" src="/media/{{complaint.doctor.signature}}">
                    <div class="doctor-name">
                        {{complaint.doctor.get_full_name}}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </body>
</html>
