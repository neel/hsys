{% load staticfiles %}
{% load identity_extras %}
<!DOCTYPE html>
<html>
    <head>
        <title>Doctors</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
        <style type='text/css'>
            @import url('{% static 'css/daterangepicker.css' %}');
            @import url('{% static 'css/jquery.datetimepicker.css' %}');
            @import url('{% static 'css/common.css' %}');
            @import url('{% static 'css/heading.css' %}');
            @import url('{% static 'css/doctor.css' %}');

            @import url('{% static 'css/sprite/notice.css' %}');
            @import url('{% static 'css/sprite/doctor.css' %}');
            @import url('{% static 'css/sprite/notice.css' %}');
            @import url('{% static 'css/sprite/appointment.css' %}');
            @import url('{% static 'css/sprite/negotiation.css' %}');
            @import url('{% static 'css/sprite/ministory.css' %}');
            @import url('{% static 'css/sprite/patient.css' %}');
            @import url('{% static 'css/sprite/admission.css' %}');

            @import url('{% static 'css/panel/doctor.css' %}');
            @import url('{% static 'css/panel/admissions.css' %}');
            @import url('{% static 'css/panel/patients.css' %}');
            @import url('{% static 'css/panel/appointments.css' %}');
            @import url('{% static 'css/panel/ministories.css' %}');
            @import url('{% static 'css/panel/story-creation.css' %}');
            @import url('{% static 'css/sprite/story-viewer.css' %}');
            @import url('{% static 'css/sprite/doctor.css' %}');
            @import url('{% static 'css/sprite/patient.css' %}');
            @import url('{% static 'css/sprite/admission.css' %}');

            .component-sprite{
                margin-right: 3px;
                margin-bottom: 3px;
            }
            .doctor-sprite{
                float: left;
            }
            .patient-sprite{
                float: left;
            }
            .organization-sprite{
                width: 501px;
                float: left;
            }
            .filter{
                margin: 0px;
                padding: 0px;
                color: white;
                float: left;
                position: relative;
            }
            .filter:hover{
                margin: 0px;
                padding: 0px;
            }
            .filter-button{
                list-style-type: none;
                float: left;
                margin-left: 7px;
                padding-top: 8px;
            }
            .filter-button:hover{
                background: #E4E4E6;
                margin: 0px;
                color: #252734;
                height: 100%;
                padding-left: 7px;
                padding-right: 7px;
                padding-bottom: 7px;
                cursor: pointer;
            }
            .patient-item{

            }
        </style>
        <script type="text/javascript" src="{% static 'js/jquery.3.2.1.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/jquery.sticky-kit.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/jquery.cookie.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/d3.v3.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/moment.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/jquery.datetimepicker.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/jquery.daterangepicker.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/sprite/appointment.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/panel/appointments.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/panel/ministories.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/typeahead.bundle.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/handlebars-v1.3.0.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/panel/appointment-creation.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/panel/story-creation.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/sprite/story-viewer.js' %}"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
        <!--
        <script type="text/javascript" src="{% static 'js/panel/admissions.js' %}"></script>
        -->
        <script type="text/javascript">
            $(document).ready(function(){
                $("#heading").stick_in_parent();
                $("#patient-bio").stick_in_parent();
                $('#story_creation_button').click(function(){
                    var panel = $('#story_creation_panel');
                    if(panel.is(':visible')){
                        panel.hide();
                        $('#story_creation_button').show();
                    }else{
                        panel.show();
                        $('#story_creation_button').hide();
                    }
                });
                $('#story_creation_reset').click(function(){
                    $('#story_creation_button').trigger('click');
                });
                $('#story_creation_form').submit(function(e){
                    e.preventDefault();
                    var overlay = $('#story_creation_panel .story-creation-form-overlay');
                    $('.form-field-error ul').html('');
                    overlay.addClass('story-creation-form-overlay-loading');
                    $.ajax({
                        url:  $(this).attr('action'),
                        data: $(this).serializeArray(),
                        type: 'POST',
                        success: function(data){
                            overlay.removeClass('story-creation-form-overlay-loading');
                            overlay.html('');
                            if(data.success){
                                overlay.addClass('story-creation-form-overlay-success');
                                overlay.html('Successfully Created Story');
                                overlay.show();
                                setTimeout(function(){
                                    overlay.removeClass('story-creation-form-overlay-success');
                                    overlay.html('');
                                    overlay.hide();
                                    $('#story_creation_button').trigger('click');
                                }, 1500);
                            }else{
                                $.each(data.errors, function(key, errors){
                                    var elem = $('#id_'+key);
                                    var error_div = $(elem.siblings('.form-field-error')[0]);
                                    var error_ul = error_div.find('ul');
                                    error_ul.html('');
                                    $.each(errors, function(i, error){
                                        var li = $("<li>"+error+"</li>");
                                        error_ul.append(li);
                                    });
                                });
                            }
                            console.log(data);
                        },
                        error: function(xhr){
                            overlay.removeClass('story-creation-form-overlay-loading');
                            overlay.html('');
                            if(xhr.status == 403){
                                var error_panel =  $('#story_creation_panel .form-error');
                                error_panel.html('You are Not Authorized to Create an Appointment');
                            }
                        }
                    });
                    return false;
                });
                $("#periodic_medication").click(function(){
                  var form = $('<form> \
                    <div class="input-group"> \
                      <span class="input-group-addon" id="basic-addon1">Medicine Name</span> \
                      <input name="medname" type="text" class="form-control" placeholder="Medicine Name" aria-describedby="basic-addon1"> \
                      <span class="input-group-addon" id="basic-addon1">Dose</span> \
                      <input name="meddose" type="text" class="form-control" placeholder="in mg" aria-describedby="basic-addon1"> \
                    </div> \
                    <div class="input-group"> \
                      <div class="input-group-btn"> \
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Interval <span class="caret"></span></button> \
                        <ul class="dropdown-menu"> \
                            <li><a href="#" data-interval="">Once Daily</a></li> \
                            <li><a href="#" data-interval="">Twice Daily</a></li> \
                            <li><a href="#" data-interval="">Thrice Daily</a></li> \
                            <li><a href="#" data-interval="">4 times Daily</a></li> \
                            <li role="separator" class="divider"></li> \
                            <li><a href="#" data-interval="">Alternate Days</a></li> \
                            <li role="separator" class="divider"></li> \
                            <li><a href="#" data-interval="">Once in a Week</a></li> \
                        </ul> \
                      </div> \
                      <input type="text" name="medinterval" class="form-control" placeholder="in hours (12 for twice daily)" aria-describedby="basic-addon1"> \
                      <div class="input-group-btn"> \
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Termination <span class="caret"></span></button> \
                        <ul class="dropdown-menu"> \
                            <li><a href="#" data-interval="">After 1 Week</a></li> \
                            <li><a href="#" data-interval="">After 2 Weeks</a></li> \
                            <li><a href="#" data-interval="">After 3 Weeks</a></li> \
                            <li><a href="#" data-interval="">After 4 Weeks</a></li> \
                            <li role="separator" class="divider"></li> \
                            <li><a href="#" data-interval="">After 1 month</a></li> \
                            <li><a href="#" data-interval="">After 2 months</a></li> \
                            <li><a href="#" data-interval="">After 3 month</a></li> \
                            <li><a href="#" data-interval="">After 4 months</a></li> \
                            <li role="separator" class="divider"></li> \
                            <li><a href="#" data-interval="">Until adviced</a></li> \
                        </ul> \
                      </div> \
                      <input type="text" name="medterm" class="form-control" placeholder="in days" aria-describedby="basic-addon1"> \
                      <div class="input-group-btn"> \
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">When<span class="caret"></span></button> \
                        <ul class="dropdown-menu"> \
                            <li><a href="#">Anytime</a></li> \
                            <li><a href="#">Before Meal</a></li> \
                            <li><a href="#">After Meal</a></li> \
                        </ul> \
                      </div> \
                    </div> \
                  </form>');
                  bootbox.alert(form, function(){
                      var name = form.find('input[name=medname]').val();
                      var dose = form.find('input[name=meddose]').val();
                      var interval = form.find('input[name=medinterval]').val();
                      var termination = form.find('input[name=medterm]').val();
                      var data = {id: (+new Date)+Math.random(), "name": name, "dose": dose, "interval": interval, "termination": termination};
                      console.log(data);
                  });
                });
                $("#ontime_medication").click(function(){
                    
                });
            });
        </script>
    </head>
    <body>
        <div class="heading" id="heading">
            <div class="logo">//smcc:identity//</div>
            <div class="user">
                <a id="user_button" href="{% url 'doctor' doctor.id %}">{{request.user.get_short_name}}</a>
                <div class="user-menu" id="user_menu">
                    <ul class="user-menu-options">
                        <li class="user-menu-option"><a href="/user/land">Profile</a></li>
                        <li class="user-menu-option">Account</li>
                        <li class="user-menu-option user-menu-option-break">&nbsp;</li>
                        <li class="user-menu-option user-menu-option-last"><a href="/user/logout">Logout</a></li>
                    </ul>
                </div>
            </div>
            <div class="search">
                <input type="text" value="" class="search-input" />
            </div>
            <div class="map"></div>
        </div>
        <div class="main" id="main">
            {% view 'identity.panels.DoctorPanel' doctor %}
            <div class="content">
                {% for notice in notices %}
                    {% view 'identity.sprites.NoticeSprite' notice %}
                {% endfor %}
                {% view 'identity.panels.AdmissionsPanel' admissions %}
                {% view 'identity.panels.AppointmentsPanel' appointments %}
                {% view 'identity.panels.MiniStoriesPanel' stories %}
                {% view 'identity.panels.PatientsPanel' patients %}
            </div>
            {% view 'identity.panels.RandomStoryCreationPanel' story_form %}
        </div>
    </body>
</html>
